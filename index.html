<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cadastro de Vencimentos de Produtos</title>
  <script src="https://unpkg.com/html5-qrcode" defer></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <style>
    * {
      box-sizing: border-box;
      font-family: 'Segoe UI', sans-serif;
    }

    body {
      background-color: #f5f6fa;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    h1 {
      text-align: center;
      margin-top: 1.5rem;
      color: #2f3640;
    }

    form {
      background-color: #fff;
      padding: 20px;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      border-radius: 10px;
      position: relative;
      z-index: 1;
    }

    label {
      margin-top: 15px;
      display: block;
      font-weight: bold;
      color: #333;
    }

    .ean-group {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .ean-group input {
      flex: 1;
    }

    input, select {
      width: 100%;
      padding: 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 1rem;
    }

    .scanner-btn {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 1.5rem;
      color: #ff6b6b;
    }

    button[type="submit"] {
      margin-top: 20px;
      background-color: #ff6b6b;
      color: white;
      border: none;
      padding: 12px;
      font-size: 1rem;
      border-radius: 6px;
      width: 100%;
      cursor: pointer;
    }

    #reader-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0,0,0,0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 999;
    }

    #reader {
      width: 90%;
      max-width: 400px;
      background: white;
      border-radius: 10px;
      padding: 10px;
    }

    #close-scanner {
      position: absolute;
      top: 10px;
      right: 10px;
      background: transparent;
      border: none;
      font-size: 1.5rem;
      color: white;
      cursor: pointer;
    }

    #signature {
      margin: 40px 0 20px;
      color: #888;
      font-size: 0.9rem;
      text-align: center;
    }

    @media (max-width: 500px) {
      .ean-group {
        flex-direction: column;
        align-items: stretch;
      }

      .scanner-btn {
        align-self: flex-start;
        margin-top: -8px;
      }
    }
  </style>
</head>
<body>
  <h1>Cadastro de Vencimentos de Produtos</h1>

  <form id="productForm">
    <label for="ean">CÃ³digo de Barras</label>
    <div class="ean-group">
      <input type="text" id="ean" name="ean" required placeholder="Digite ou escaneie o cÃ³digo">
      <button type="button" class="scanner-btn" onclick="iniciarScanner()" title="Ativar Scanner">
        <i class="fas fa-barcode"></i>
      </button>
    </div>

    <label for="quantidade">Quantidade</label>
    <input type="number" id="quantidade" name="quantidade" required>

    <label for="validade">Validade</label>
    <input type="date" id="validade" name="validade" required>

    <label for="setor">Setor</label>
    <select id="setor" name="setor" required>
      <option value="">Selecione...</option>
      <option>ArmazÃ©m</option>
      <option>Padaria</option>
      <option>AÃ§ougue</option>
      <option>Frios e Congelados</option>
    </select>

    <button type="submit">Enviar</button>
  </form>

  <div id="reader-container" style="display:none;">
    <button id="close-scanner" onclick="fecharScanner()">&times;</button>
    <div id="reader"></div>
  </div>

  <div id="signature">
    Desenvolvido por <strong>Maycon Miranda Martins</strong>
  </div>

  <script>
    let html5QrCode;

    function iniciarScanner() {
      const container = document.getElementById("reader-container");
      container.style.display = "flex";

      html5QrCode = new Html5Qrcode("reader");
      const config = {
        fps: 10,
        qrbox: { width: 250, height: 100 },
        formatsToSupport: [Html5QrcodeSupportedFormats.EAN_13]
      };

      Html5Qrcode.getCameras().then(devices => {
        if (devices && devices.length) {
          html5QrCode.start(
            { facingMode: "environment" },
            config,
            (decodedText) => {
              document.getElementById("ean").value = decodedText;
              html5QrCode.stop();
              container.style.display = "none";
            },
            () => {}
          );
        }
      }).catch(err => {
        alert("Erro ao acessar a cÃ¢mera: " + err);
        container.style.display = "none";
      });
    }

    function fecharScanner() {
      document.getElementById("reader-container").style.display = "none";
      if (html5QrCode) {
        html5QrCode.stop().catch(() => {});
      }
    }

    const form = document.getElementById("productForm");

    form.addEventListener("submit", function(e) {
      e.preventDefault();

      const formData = new FormData(form);
      const data = Object.fromEntries(formData.entries());

      fetch("https://controledata.app.n8n.cloud/webhook/formulario", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      }).then(() => {
        form.style.display = "none";

        const thanks = document.createElement("div");
        thanks.innerHTML = `
          <div style="text-align: center; margin-top: 50px;">
            <h2 style="color: #2f3640;">âœ… Produto cadastrado com sucesso!</h2>
            <p style="font-size: 1.2rem; color: #555;">Obrigado pela ContribuiÃ§Ã£o ðŸ¥¹.</p>
            <button onclick="window.location.reload()" style="
              margin-top: 20px;
              background-color: #ff6b6b;
              color: white;
              border: none;
              padding: 12px 20px;
              font-size: 1rem;
              border-radius: 6px;
              cursor: pointer;">
              Cadastrar outro produto
            </button>
          </div>
        `;
        document.body.appendChild(thanks);
      });
    });
  </script>
</body>
</html>
